"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var Promise$1=_interopDefault(require("bluebird")),$inject_Object_values=_interopDefault(require("object-values")),Unauthorized={code:401,message:"Unauthorized application ID"},NotFound={code:404,message:"Route not found"},InternalServer={code:500,message:"Internal skill error"},errorCodes=Object.freeze({Unauthorized:Unauthorized,NotFound:NotFound,InternalServer:InternalServer}),asyncGenerator=function(){function e(e){this.value=e}function t(t){function n(e,t){return new Promise(function(n,o){var a={key:e,arg:t,resolve:n,reject:o,next:null};i?i=i.next=a:(u=i=a,r(e,t))})}function r(n,u){try{var i=t[n](u),a=i.value;a instanceof e?Promise.resolve(a.value).then(function(e){r("next",e)},function(e){r("throw",e)}):o(i.done?"return":"normal",i.value)}catch(e){o("throw",e)}}function o(e,t){switch(e){case"return":u.resolve({value:t,done:!0});break;case"throw":u.reject(t);break;default:u.resolve({value:t,done:!1})}u=u.next,u?r(u.key,u.arg):i=null}var u,i;this._invoke=n,"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),defineProperty=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},get=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var u=Object.getPrototypeOf(t);return null===u?void 0:e(u,n,r)}if("value"in o)return o.value;var i=o.get;if(void 0!==i)return i.call(r)},set=function e(t,n,r,o){var u=Object.getOwnPropertyDescriptor(t,n);if(void 0===u){var i=Object.getPrototypeOf(t);null!==i&&e(i,n,r,o)}else if("value"in u&&u.writable)u.value=r;else{var a=u.set;void 0!==a&&a.call(o,r)}return r},slicedToArray=function(){function e(e,t){var n=[],r=!0,o=!1,u=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,u=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw u}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_class,_temp,Request=(_temp=_class=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};classCallCheck(this,e),this.state=t}return createClass(e,[{key:"session",value:function(t){return new e(_extends({},this.state,{session:_extends({},this.state.session,t)}))}},{key:"intent",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Object.entries(n).reduce(function(e,t){var n=slicedToArray(t,2),r=n[0],o=n[1];return _extends({},e,defineProperty({},r,{name:r,value:o}))},{});return new e(_extends({},this.state,{request:{type:"IntentRequest",intent:_extends({name:t},Object.keys(r).length?{slots:r}:null)}}))}},{key:"audioPlayerEvent",value:function(t,n){return new e(_extends({},this.state,{request:{type:t,token:n}}))}},{key:"launchRequest",value:function(){return new e(_extends({},this.state,{request:{type:"LaunchRequest"}}))}},{key:"sessionEndedRequest",value:function(){return new e(_extends({},this.state,{request:{type:"SessionEndedRequest"}}))}},{key:"build",value:function(){return _extends({},this.state)}}]),e}(),_class.session=function(){var e;return(e=new Request).session.apply(e,arguments)},_class.intent=function(){var e;return(e=new Request).intent.apply(e,arguments)},_class.audioPlayerEvent=function(){var e;return(e=new Request).audioPlayerEvent.apply(e,arguments)},_class.launchRequest=function(){var e;return(e=new Request).launchRequest.apply(e,arguments)},_class.sessionEndedRequest=function(){var e;return(e=new Request).sessionEndedRequest.apply(e,arguments)},_temp),isAuthorized=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise$1(function(n,r){var o=!e.applicationId||e.applicationId===t.applicationId;return o?n():r(Unauthorized)})},SkillAnnotation=function(e){return function(t){return function(n,r,o){var u=n||{},i=u.request,a=u.session,s=a||{},l=s.application,c=s.attributes;return isAuthorized(e,l).then(function(){return new t(a).route(i)||Promise$1.reject(NotFound)}).then(function(e){return"function"==typeof e.build?e.build(c):e}).then(function(e){return o&&o(null,e),e}).catch(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:InternalServer;return o&&o(e),e}).then(function(t){if(e.logging!==!1){var n="string"==typeof e.logging?e.logging:"Skill";console.log("["+n+"]",JSON.stringify({request:i,response:t}))}return t})}}},skill=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="function"==typeof e,n=t?{}:e,r=t&&e;return t?SkillAnnotation(n)(r):SkillAnnotation(n)},annotation=function(e,t){return function(n,r){var o=n.route||function(){return!1};return n.route=function(u){var i=t?[t(u),u]:[u];return o.call(this,u)||e(u)&&n[r].apply(this,i)},n}},Launch=annotation(function(e){var t=e.type;return"LaunchRequest"===t}),SessionEnded=annotation(function(e){var t=e.type;return"SessionEndedRequest"===t}),Intent=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return annotation(function(e){var n=e.type,r=e.intent,o=void 0===r?{}:r;return"IntentRequest"===n&&t.indexOf(o.name)>=0},function(e){var t=e.intent,n=void 0===t?{}:t;return $inject_Object_values(n.slots||{}).reduce(function(e,t){var n=t.name,r=t.value;return n&&null!=r?_extends({},e,defineProperty({},n,r)):e},{})})},AudioPlayerEvent=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return annotation(function(e){var n=e.type,r=void 0===n?{}:n;return t.indexOf(r)>=0})};exports.ErrorCode=errorCodes,exports.Request=Request,exports.Skill=skill,exports.Launch=Launch,exports.Intent=Intent,exports.SessionEnded=SessionEnded,exports.AudioPlayerEvent=AudioPlayerEvent;
